---
title: "RT normalization in SL tasks: yes or no?"
output: html_notebook
---

RT normalization on the level of subjects may help in controlling for baseline RT effects: if a subject has low baseline RT (in the random block; baseline RT - practice effect), they might have less room to improve as compared to subjects who have higher baseline RTs. On the other hand, this method is disregards subjects who have high baseline RTs and show little progress, and subjects who have even higher baseline RTs, show considerable progress, but their lowest RTs are still far from the "minimal" RT level in the task.

Next, we will look at six possible scenarios regarding baseline RTs and the extent of RT decrease through the task.

* ID 1: low starting RT, low attained RT, low baseline (RND) RT --> their baseline RT is low so we cannot tell whether they are a good learner or not
* ID 2: high starting RT, high attained RT, high baseline (RND) RT --> not good learner as attained RT has little difference from baseline RT
* ID 3: low starting RT, low attained RT, high baseline (RND) RT --> good and quick learner
* ID 4: high starting RT, low attained RT, high baseline (RND) RT --> good and slow learner
* ID 5: high starting RT, low attained RT, low baseline (RND) RT --> large practice effect, their baseline RT is low so we cannot tell whether they are a good learner or not
* ID 6: higher starting RT, high attained RT, high baseline (RND) RT --> large practice effect but not good learner as attained RT has little difference from baseline RT

```{r}
library(tidyverse)
library(magrittr)
```

# 1. Simulated data

```{r}
n = 10000

s1 = tibble(ID = rep(1, n * 5),
            block = c(rep(1, n),
                      rep(2, n),
                      rep(3, n),
                      rep(4, n),
                      rep(5, n)),
            RT = c(rnorm(n, mean = 0.2, sd = 0.1),
                   rnorm(n, mean = 0.1, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1),
                   rnorm(n, mean = 0.3, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1)))
s1 = s1 %>% 
  mutate(RT_norm = scale(RT))

s2 = tibble(ID = rep(2, n * 5),
            block = c(rep(1, n),
                      rep(2, n),
                      rep(3, n),
                      rep(4, n),
                      rep(5, n)),
            RT = c(rnorm(n, mean = 0.6, sd = 0.1),
                   rnorm(n, mean = 0.5, sd = 0.1),
                   rnorm(n, mean = 0.4, sd = 0.1),
                   rnorm(n, mean = 0.7, sd = 0.1),
                   rnorm(n, mean = 0.4, sd = 0.1)))
s2 = s2 %>% 
  mutate(RT_norm = scale(RT))

s3 = tibble(ID = rep(3, n * 5),
            block = c(rep(1, n),
                      rep(2, n),
                      rep(3, n),
                      rep(4, n),
                      rep(5, n)),
            RT = c(rnorm(n, mean = 0.2, sd = 0.1),
                   rnorm(n, mean = 0.1, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1),
                   rnorm(n, mean = 0.7, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1)))
s3 = s3 %>% 
  mutate(RT_norm = scale(RT))

s4 = tibble(ID = rep(4, n * 5),
            block = c(rep(1, n),
                      rep(2, n),
                      rep(3, n),
                      rep(4, n),
                      rep(5, n)),
            RT = c(rnorm(n, mean = 0.6, sd = 0.1),
                   rnorm(n, mean = 0.3, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1),
                   rnorm(n, mean = 0.7, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1)))
s4 = s4 %>% 
  mutate(RT_norm = scale(RT))

s5 = tibble(ID = rep(5, n * 5),
            block = c(rep(1, n),
                      rep(2, n),
                      rep(3, n),
                      rep(4, n),
                      rep(5, n)),
            RT = c(rnorm(n, mean = 0.6, sd = 0.1),
                   rnorm(n, mean = 0.3, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1),
                   rnorm(n, mean = 0.3, sd = 0.1),
                   rnorm(n, mean = 0.0, sd = 0.1)))
s5 = s5 %>% 
  mutate(RT_norm = scale(RT))


s6 = tibble(ID = rep(6, n * 5),
            block = c(rep(1, n),
                      rep(2, n),
                      rep(3, n),
                      rep(4, n),
                      rep(5, n)),
            RT = c(rnorm(n, mean = 1.0, sd = 0.1),
                   rnorm(n, mean = 0.7, sd = 0.1),
                   rnorm(n, mean = 0.4, sd = 0.1),
                   rnorm(n, mean = 0.7, sd = 0.1),
                   rnorm(n, mean = 0.4, sd = 0.1)))
s6 = s6 %>% 
  mutate(RT_norm = scale(RT))

sim = bind_rows(s1, s2, s3, s4, s5, s6)
remove(s1, s2, s3, s4, s5, s6)
```

```{r}
sim %>% 
  group_by(ID, block) %>% 
  summarize(RT = median(RT),
            RT_norm = median(RT_norm)) %>% 
  pivot_longer(cols = c(RT, RT_norm),
               names_to = "RT_type",
               values_to = "RT") %>% 
  ggplot(aes(x = block, y = RT)) +
  geom_point() +
  geom_path() +
  facet_grid(rows = vars(RT_type), cols = vars(ID))
```
To conclude, normalization sets

* the smallest learning scores for subjects who have high starting RTs, and lower baseline RTs, and little difference between baseline and attained RTs (regardless of the actual level of their baseline) --> they have large practice effects and 1) they are bad learners (ID6) or 2) we cannot tell whether they are good learners or not (ID5)
* larger learning scores for those who have little difference between attained RTs and baseline RTs, but have little practice effect --> 1) they are bad learners (ID 2) or 2) we cannot tell if they are good learners or not (ID 1)
* slower but good learners have larger learning scores (ID4)
* quick and good learners have the largest learning scores (ID3)

# 2. Data of children vs. adults

```{r}
segm1 = read.csv("C:/Users/Kriszti/LENDULET/kiserletek/elemzesek/AN_SEGM_online_AL_YA_2key/data/SEGM_AL_AL_2key_wide_20230129_FINAL_SAMPLE.csv", colClasses = c("ID" = "character"))
segm2 = read.csv("C:/Users/Kriszti/LENDULET/kiserletek/elemzesek/AN_SEGM_online_AL_2keys_child_450ms/data/normRTs_SEGM_AL_children_wide_20220215_FINAL_SAMPLE_dprime_filtered.csv", colClasses = c("ID" = "character"))
segm3 = read.csv("C:/Users/Kriszti/LENDULET/kiserletek/elemzesek/AN_SEGM_online_AL_2keys_child_450ms_letterID/data/SEGM_AL_2keys_letterID_wide_20230428.csv", colClasses = c("ID" = "character"))
segm4 = read.csv("C:/Users/Kriszti/LENDULET/kiserletek/elemzesek/AN_SEGM_online_AL_2key_300ms_letterID/data/SEGM_AL_2key_letterID_wide_20230427.csv", colClasses = c("ID" = "character"))
adult = bind_rows(segm1, segm4)
child = bind_rows(segm2, segm3)
remove(segm1, segm2, segm3, segm4)
```

```{r}
segm =
bind_rows(
bind_rows(
child %>% 
  select(ID, mednormRT_TRN1, mednormRT_TRN2, mednormRT_TRN3, mednormRT_RND4, mednormRT_REC5) %>% 
  pivot_longer(cols = c(mednormRT_TRN1, mednormRT_TRN2, mednormRT_TRN3, mednormRT_RND4, mednormRT_REC5),
               names_to = "block",
               values_to = "RT") %>% 
  mutate(
    group = "children",
    RT_type = "norm",
    block = case_when(
      block == "mednormRT_TRN1" ~ 1,
      block == "mednormRT_TRN2" ~ 2,
      block == "mednormRT_TRN3" ~ 3,
      block == "mednormRT_RND4" ~ 4,
      block == "mednormRT_REC5" ~ 5)
    ),
child %>% 
  select(ID, medRT_TRN1, medRT_TRN2, medRT_TRN3, medRT_RND4, medRT_REC5) %>% 
  pivot_longer(cols = c(medRT_TRN1, medRT_TRN2, medRT_TRN3, medRT_RND4, medRT_REC5),
               names_to = "block",
               values_to = "RT") %>% 
  mutate(
    group = "children",
    RT_type = "raw",
    block = case_when(
      block == "medRT_TRN1" ~ 1,
      block == "medRT_TRN2" ~ 2,
      block == "medRT_TRN3" ~ 3,
      block == "medRT_RND4" ~ 4,
      block == "medRT_REC5" ~ 5)
    )
),

bind_rows(
adult %>% 
  select(ID, mednormRT_TRN1, mednormRT_TRN2, mednormRT_TRN3, mednormRT_RND4, mednormRT_REC5) %>% 
  pivot_longer(cols = c(mednormRT_TRN1, mednormRT_TRN2, mednormRT_TRN3, mednormRT_RND4, mednormRT_REC5),
               names_to = "block",
               values_to = "RT") %>% 
  mutate(
    group = "adults",
    RT_type = "norm",
    block = case_when(
      block == "mednormRT_TRN1" ~ 1,
      block == "mednormRT_TRN2" ~ 2,
      block == "mednormRT_TRN3" ~ 3,
      block == "mednormRT_RND4" ~ 4,
      block == "mednormRT_REC5" ~ 5)
    ),
adult %>% 
  select(ID, medRT_TRN1, medRT_TRN2, medRT_TRN3, medRT_RND4, medRT_REC5) %>% 
  pivot_longer(cols = c(medRT_TRN1, medRT_TRN2, medRT_TRN3, medRT_RND4, medRT_REC5),
               names_to = "block",
               values_to = "RT") %>% 
  mutate(
    group = "adults",
    RT_type = "raw",
    block = case_when(
      block == "medRT_TRN1" ~ 1,
      block == "medRT_TRN2" ~ 2,
      block == "medRT_TRN3" ~ 3,
      block == "medRT_RND4" ~ 4,
      block == "medRT_REC5" ~ 5)
    )
)
) %>% 
  group_by(group, block, RT_type) %>% 
  summarize(RT = mean(RT, na.rm = TRUE))
```

## 2.1. Raw RTs of adults vs. children

```{r}
segm %>% 
  filter(RT_type == "raw") %>% 
  ggplot(aes(x = block, y = RT)) +
  geom_point() +
  geom_path() +
  #facet_grid(rows = vars(RT_type), cols = vars(group)) +
  facet_wrap(~group)
```

## 2.2. Normalized RTs of adults vs. children

```{r}
segm %>% 
  filter(RT_type == "norm") %>% 
  ggplot(aes(x = block, y = RT)) +
  geom_point() +
  geom_path() +
  #facet_grid(rows = vars(RT_type), cols = vars(group)) +
  facet_wrap(~group)
```

In raw reaction times, children have higher RT train scores (TRN3 - TRN1) (96 ms) and higher RT difference scores (mean((RND4 - TRN3), (RND4 - REC5))) (168 ms) than adults (65 ms and 153 ms, respectively).

However, with normalized RTs, adults and children have the same RT training score (0.41), but adults have higher RT difference scores (0.96) than children (0.76).

This distorting effect might be a result of higher initial RTs of children than the initial IDs of adults (see IDs 3 and 4 in the simulation), and not different baseline RTs. These higher initial RTs might be due to task characteristics (slower presentation rates), but also due to the characteristics of the population (slower learning).